import{k as A,l as z,r as x,m as b,X as xe,Y as ge,D as k,P as Z,p as me,w as F,Z as he,H as fe,j as t,z as D,C as N,_ as ke,T as y,J as _,c as U,a as O,e as be,S as E,b as R,g as Q,$ as ee,a0 as se,f as je,a1 as $,t as De,h as Se,B as Ce}from"./index-C9u05q5f.js";import{p as ve}from"./storage-Bfrp25ku.js";import{T as ye,a as S,t as te,u as Te,b as we,c as Me,D as Ie,d as Pe}from"./TaskColumn-Ck_55160.js";import{u as We,C as X,F as Y}from"./index.esm-BLVu4YKL.js";import{T as G,I as q}from"./TextField-B7Q7xUip.js";import{S as J}from"./Select-BSNLH38p.js";import{M as W}from"./MenuItem-BPPxlaaA.js";import"./utils-Cte3m1Zk.js";function Be(e){return z("MuiDialog",e)}const B=A("MuiDialog",["root","scrollPaper","scrollBody","container","paper","paperScrollPaper","paperScrollBody","paperWidthFalse","paperWidthXs","paperWidthSm","paperWidthMd","paperWidthLg","paperWidthXl","paperFullWidth","paperFullScreen"]),ae=x.createContext({}),Ee=b(xe,{name:"MuiDialog",slot:"Backdrop",overrides:(e,s)=>s.backdrop})({zIndex:-1}),Re=e=>{const{classes:s,scroll:a,maxWidth:i,fullWidth:o,fullScreen:n}=e,l={root:["root"],container:["container",`scroll${k(a)}`],paper:["paper",`paperScroll${k(a)}`,`paperWidth${k(String(i))}`,o&&"paperFullWidth",n&&"paperFullScreen"]};return N(l,Be,s)},$e=b(ge,{name:"MuiDialog",slot:"Root",overridesResolver:(e,s)=>s.root})({"@media print":{position:"absolute !important"}}),Ae=b("div",{name:"MuiDialog",slot:"Container",overridesResolver:(e,s)=>{const{ownerState:a}=e;return[s.container,s[`scroll${k(a.scroll)}`]]}})({height:"100%","@media print":{height:"auto"},outline:0,variants:[{props:{scroll:"paper"},style:{display:"flex",justifyContent:"center",alignItems:"center"}},{props:{scroll:"body"},style:{overflowY:"auto",overflowX:"hidden",textAlign:"center","&::after":{content:'""',display:"inline-block",verticalAlign:"middle",height:"100%",width:"0"}}}]}),ze=b(Z,{name:"MuiDialog",slot:"Paper",overridesResolver:(e,s)=>{const{ownerState:a}=e;return[s.paper,s[`scrollPaper${k(a.scroll)}`],s[`paperWidth${k(String(a.maxWidth))}`],a.fullWidth&&s.paperFullWidth,a.fullScreen&&s.paperFullScreen]}})(me(({theme:e})=>({margin:32,position:"relative",overflowY:"auto","@media print":{overflowY:"visible",boxShadow:"none"},variants:[{props:{scroll:"paper"},style:{display:"flex",flexDirection:"column",maxHeight:"calc(100% - 64px)"}},{props:{scroll:"body"},style:{display:"inline-block",verticalAlign:"middle",textAlign:"initial"}},{props:({ownerState:s})=>!s.maxWidth,style:{maxWidth:"calc(100% - 64px)"}},{props:{maxWidth:"xs"},style:{maxWidth:e.breakpoints.unit==="px"?Math.max(e.breakpoints.values.xs,444):`max(${e.breakpoints.values.xs}${e.breakpoints.unit}, 444px)`,[`&.${B.paperScrollBody}`]:{[e.breakpoints.down(Math.max(e.breakpoints.values.xs,444)+32*2)]:{maxWidth:"calc(100% - 64px)"}}}},...Object.keys(e.breakpoints.values).filter(s=>s!=="xs").map(s=>({props:{maxWidth:s},style:{maxWidth:`${e.breakpoints.values[s]}${e.breakpoints.unit}`,[`&.${B.paperScrollBody}`]:{[e.breakpoints.down(e.breakpoints.values[s]+32*2)]:{maxWidth:"calc(100% - 64px)"}}}})),{props:({ownerState:s})=>s.fullWidth,style:{width:"calc(100% - 64px)"}},{props:({ownerState:s})=>s.fullScreen,style:{margin:0,width:"100%",maxWidth:"100%",height:"100%",maxHeight:"none",borderRadius:0,[`&.${B.paperScrollBody}`]:{margin:0,maxWidth:"100%"}}}]}))),Fe=x.forwardRef(function(s,a){const i=F({props:s,name:"MuiDialog"}),o=he(),n={enter:o.transitions.duration.enteringScreen,exit:o.transitions.duration.leavingScreen},{"aria-describedby":l,"aria-labelledby":r,BackdropComponent:c,BackdropProps:d,children:p,className:h,disableEscapeKeyDown:g=!1,fullScreen:j=!1,fullWidth:T=!1,maxWidth:C="sm",onBackdropClick:m,onClick:u,onClose:w,open:L,PaperComponent:ne=Z,PaperProps:V={},scroll:ie="paper",TransitionComponent:re=ke,transitionDuration:H=n,TransitionProps:le,...ce}=i,v={...i,disableEscapeKeyDown:g,fullScreen:j,fullWidth:T,maxWidth:C,scroll:ie},M=Re(v),I=x.useRef(),de=f=>{I.current=f.target===f.currentTarget},pe=f=>{u&&u(f),I.current&&(I.current=null,m&&m(f),w&&w(f,"backdropClick"))},P=fe(r),ue=x.useMemo(()=>({titleId:P}),[P]);return t.jsx($e,{className:D(M.root,h),closeAfterTransition:!0,components:{Backdrop:Ee},componentsProps:{backdrop:{transitionDuration:H,as:c,...d}},disableEscapeKeyDown:g,onClose:w,open:L,ref:a,onClick:pe,ownerState:v,...ce,children:t.jsx(re,{appear:!0,in:L,timeout:H,role:"presentation",...le,children:t.jsx(Ae,{className:D(M.container),onMouseDown:de,ownerState:v,children:t.jsx(ze,{as:ne,elevation:24,role:"dialog","aria-describedby":l,"aria-labelledby":P,...V,className:D(M.paper,V.className),ownerState:v,children:t.jsx(ae.Provider,{value:ue,children:p})})})})})});function Ne(e){return z("MuiDialogActions",e)}A("MuiDialogActions",["root","spacing"]);const Ue=e=>{const{classes:s,disableSpacing:a}=e;return N({root:["root",!a&&"spacing"]},Ne,s)},Le=b("div",{name:"MuiDialogActions",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:a}=e;return[s.root,!a.disableSpacing&&s.spacing]}})({display:"flex",alignItems:"center",padding:8,justifyContent:"flex-end",flex:"0 0 auto",variants:[{props:({ownerState:e})=>!e.disableSpacing,style:{"& > :not(style) ~ :not(style)":{marginLeft:8}}}]}),Ve=x.forwardRef(function(s,a){const i=F({props:s,name:"MuiDialogActions"}),{className:o,disableSpacing:n=!1,...l}=i,r={...i,disableSpacing:n},c=Ue(r);return t.jsx(Le,{className:D(c.root,o),ownerState:r,ref:a,...l})});function He(e){return z("MuiDialogTitle",e)}A("MuiDialogTitle",["root"]);const Oe=e=>{const{classes:s}=e;return N({root:["root"]},He,s)},Xe=b(y,{name:"MuiDialogTitle",slot:"Root",overridesResolver:(e,s)=>s.root})({padding:"16px 24px",flex:"0 0 auto"}),Ye=x.forwardRef(function(s,a){const i=F({props:s,name:"MuiDialogTitle"}),{className:o,id:n,...l}=i,r=i,c=Oe(r),{titleId:d=n}=x.useContext(ae);return t.jsx(Xe,{component:"h2",className:D(c.root,o),ownerState:r,ref:a,variant:"h6",id:n??d,...l})}),oe=()=>{const e=x.useContext(ye);if(!e)throw new Error("useTasksContext must be used within a TasksContextProvider");return e},K=(e,s)=>{if(s)return s.filter(a=>a.status===e)},Ge=e=>S.getByProjectId(e)||[],qe=_(t.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.996.996 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Edit"),Je=({taskId:e,setEditedTask:s})=>{var C;const[a,i]=x.useState(!1),{id:o}=U();if(!o)return t.jsx(y,{children:"Error"});const n=S.getById(e);if(!n)return t.jsx(y,{children:"Error"});const l=We({defaultValues:{name:n.name,description:n.description,assigneeId:((C=n.assignee)==null?void 0:C.id)||O.Unspecified,status:n.status}}),{register:r,handleSubmit:c,getValues:d,control:p,formState:h,reset:g}=l,j=be.get(),T=()=>{const m={name:d("name").trim(),description:d("description").trim(),assigneeId:d("assigneeId"),status:d("status")},u=S.updateOne(e,m);u&&(i(!0),s(u),g(m))};return t.jsx("form",{onSubmit:c(T),noValidate:!0,children:t.jsxs(E,{spacing:2,children:[t.jsx(G,{id:"task-name",label:"Name",variant:"filled",sx:{alignSelf:"flex-start",width:"100%"},size:"small",...r("name",{required:!0})}),t.jsx(G,{id:"task-description",label:"Description",variant:"filled",sx:{alignSelf:"flex-start",width:"100%"},size:"small",multiline:!0,minRows:3,maxRows:3,...r("description")}),t.jsx(X,{control:p,name:"assigneeId",render:({field:m})=>t.jsxs(Y,{fullWidth:!0,children:[t.jsx(q,{id:"task-assignee-label",children:"Assignee"}),t.jsxs(J,{id:"task-assignee",labelId:"task-assignee-label",label:"Assignee",...m,sx:{alignSelf:"flex-start",width:"100%"},children:[t.jsx(W,{value:O.Unspecified,children:"Unspecified"}),j==null?void 0:j.data.map(u=>t.jsx(W,{value:u.id,children:u.name},u.id))]})]})}),t.jsx(X,{control:p,name:"status",render:({field:m})=>t.jsxs(Y,{fullWidth:!0,children:[t.jsx(q,{id:"task-status-label",children:"Status"}),t.jsx(J,{id:"task-status",labelId:"task-status-label",label:"Status",...m,sx:{alignSelf:"flex-start",width:"100%"},children:te.map(u=>t.jsx(W,{value:u.id,children:u.label},u.id))})]})}),t.jsxs(E,{direction:"row",spacing:2,sx:{alignItems:"center"},children:[t.jsx(R,{variant:"contained",disabled:!h.isDirty,type:"submit",children:"Save"}),a&&t.jsx(y,{color:"success",children:"Changes saved."})]})]})})},Ke=({id:e,name:s,onEditorClose:a,onPointerDown:i})=>{const[o,n]=x.useState(null),{tasks:l,setTasks:r}=oe(),c=()=>{o&&r(l.map(g=>g.id===e?o:g)),a&&a()},{openModal:d,handleModalOpen:p,handleModalClose:h}=Q(!1,c);return t.jsxs(t.Fragment,{children:[t.jsx(ee,{title:"Edit",children:t.jsx(se,{size:"small",onPointerDown:i,onClick:p,children:t.jsx(qe,{})})}),t.jsx(je,{title:`Edit task '${s}'`,open:d,onClose:h,children:t.jsx(Je,{taskId:e,setEditedTask:n})})]})},Ze=e=>{if(e)return{transform:`translate(${e.x}px, ${e.y}px)`,zIndex:20,cursor:"grabbing"}},_e=_(t.jsx("path",{d:"M6 19c0 1.1.9 2 2 2h8c1.1 0 2-.9 2-2V7H6zM19 4h-3.5l-1-1h-5l-1 1H5v2h14z"}),"Delete"),Qe=({taskId:e,taskName:s,open:a,onClose:i})=>{const{id:o}=U(),{setTasks:n}=oe(),l=()=>{const r=S.delete(e);r&&n(r.filter(c=>c.projectId===o))};return t.jsx(Fe,{open:a,children:t.jsxs(E,{spacing:2,sx:{p:2},children:[t.jsxs(Ye,{sx:{p:0,fontSize:20},children:["Are you sure you want to delete task '",s,"'?"]}),t.jsxs(Ve,{sx:{p:0,mt:0},children:[t.jsx(R,{color:"primary",variant:"contained",onClick:i,children:"Cancel"}),t.jsx(R,{color:"sensitive",variant:"contained",onClick:l,children:"Delete"})]})]})})},es=({id:e,name:s,onPointerDown:a})=>{const{openModal:i,handleModalOpen:o,handleModalClose:n}=Q(!1);return t.jsxs(t.Fragment,{children:[t.jsx(ee,{title:"Delete",children:t.jsx(se,{size:"small",onPointerDown:a,onClick:o,children:t.jsx(_e,{})})}),t.jsx(Qe,{taskId:e,taskName:s,open:i,onClose:n})]})},ss=({data:e,draggable:s})=>{const[a,i]=x.useState(s),{id:o}=e,{attributes:n,listeners:l,setNodeRef:r,transform:c}=Te({id:o,disabled:!a}),d=Ze(c),p=g=>{g.stopPropagation(),i(!1)},h=()=>i(!0);return t.jsx(we,{data:e,ref:r,...l,...n,sx:{cursor:a?"grab":"default",...d},editBtn:t.jsx(Ke,{id:e.id,name:e.name,onPointerDown:p,onEditorClose:h}),deleteBtn:t.jsx(es,{id:e.id,name:e.name,onPointerDown:p})})},ts=({projectId:e})=>{const[s,a]=x.useState(()=>Ge(e)),i=o=>{const{active:n,over:l}=o;if(!l)return;const r=n.id,c=l.id;a(()=>{const d=s.map(p=>r===p.id?{...p,status:c}:p);return S.update(r,d.find(p=>p.id===r)),d})};return t.jsx($,{container:!0,spacing:2,size:"grow",sx:{[De.breakpoints.down("lg")]:{flexDirection:"column"}},children:t.jsx(Me,{tasks:s,setTasks:a,children:t.jsx(Ie,{onDragEnd:i,children:te.map(o=>{var n,l;return t.jsx($,{size:"grow",sx:{height:"100%",flexGrow:1},children:t.jsx(Pe,{label:o.label,tasksLength:((n=K(o.id,s))==null?void 0:n.length)||0,column:o,children:(l=K(o.id,s))==null?void 0:l.map(r=>t.jsx(ss,{data:r,draggable:!0},r.id))})},o.id)})})})})},ps=({})=>{const{id:e}=U(),s=ve.getById(e);return s?t.jsxs($,{container:!0,direction:"column",sx:{height:"100%"},children:[t.jsx(Se,{title:s.name,children:t.jsx(Ce,{to:"create-task",variant:"contained",children:"Add task"})}),t.jsx(ts,{projectId:e})]}):t.jsx("p",{children:"Error"})};export{ps as default};
