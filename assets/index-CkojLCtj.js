import{r as u,u as S,f as h,e as j,p as P,j as e,T as o,S as m,d as z,i as A,k as D,l as F,L,s as v,R as y,P as R}from"./index-BKcszQKM.js";import{C as b}from"./TaskColumn-B2kAtuII.js";import{T as B,A as W,E as N,D as O}from"./DeleteTaskBtn-C0QW91MG.js";import{E as H,o as U}from"./Delete-DroR5Y-1.js";import{F as V}from"./index.esm-C2g7lyzA.js";import{I as $}from"./TextField-BVlZHFqG.js";import{S as q}from"./Select-Ds_JSibu.js";import{M as G}from"./MenuItem-D_-LpAxY.js";import"./constants-DWoOd6FE.js";import"./utils-ishblJic.js";const J=({taskId:s,setEditedTask:n})=>{const[t,l]=u.useState(!1),{projectId:f}=S(),c=h.getById(s),x=j.get(),p=P.getById(f);if(!c||!x||!p)return e.jsx(o,{children:"Error"});const g=j.getManyById(c.team),[i,T]=u.useState(g),w=a=>{const r=a.target.value,d=j.getById(r);d&&T(k=>[...k,d])},C=a=>{T(i.filter(r=>r.id!==a))},E=x.data.filter(a=>{var r,d;return!i.some(k=>k.id===a.id)&&a.id!==((r=c.assignee)==null?void 0:r.id)&&a.id!==((d=p.lead)==null?void 0:d.id)});u.useEffect(()=>{l(!1)},[i]);const M=a=>{a.preventDefault();const r=i.map(d=>d.id);n({...c,team:r}),l(!0)};return e.jsx("form",{noValidate:!0,onSubmit:M,children:e.jsxs(m,{spacing:2,sx:{alignItems:"flex-start"},children:[e.jsxs(V,{fullWidth:!0,children:[e.jsx($,{id:"task-executor-label",size:"small",children:"Executor"}),e.jsx(q,{id:"task-executor",labelId:"task-executor-label",label:"Executor",size:"small",value:"",onChange:w,disabled:!E.length,sx:{alignSelf:"flex-start",width:"100%"},children:E.map(a=>e.jsx(G,{value:a.id,children:a.name},a.id))})]}),i.length?e.jsx(B,{team:i,onDelete:C,links:!1}):e.jsx(o,{children:"Task team is empty now"}),e.jsxs(m,{direction:"row",spacing:2,sx:{alignItems:"center"},children:[e.jsx(z,{variant:"contained",type:"submit",children:"Save"}),t&&e.jsx(o,{color:"success",children:"Changes saved."})]})]})})},I=({taskId:s,onEditorClose:n})=>{var i;const t=(i=h.getById(s))==null?void 0:i.name,[l,f]=u.useState(null),c=()=>{l&&h.update(l),n&&n()},{openModal:x,handleModalOpen:p,handleModalClose:g}=A(!1,c);return e.jsxs(e.Fragment,{children:[e.jsx(b,{sx:{fontSize:16},label:"Edit team",variant:"outlined",color:"primary",icon:e.jsx(H,{fontSize:"small"}),onClick:p,clickable:!0}),e.jsx(D,{title:`Edit team of task '${t}'`,open:x,onClose:g,children:e.jsx(J,{taskId:s,setEditedTask:f})})]})},K=({taskId:s,team:n})=>n.length?e.jsx(B,{team:n,editBtn:e.jsx(I,{taskId:s})}):e.jsxs(m,{spacing:2,direction:"row",sx:{flexWrap:"wrap",alignItems:"center"},children:[e.jsx(o,{children:"Task team is empty now."}),e.jsx(I,{taskId:s})]}),Q=({assignee:s})=>{var n;return e.jsx(m,{spacing:2,direction:"row",sx:{flexWrap:"wrap",alignItems:"center"},children:s?e.jsxs(e.Fragment,{children:[e.jsx(o,{children:"Assignee: "}),e.jsx(F,{title:((n=s.position)==null?void 0:n.name)||"Unspecified position",arrow:!0,children:e.jsx(b,{component:L,to:v("",y.Executors,s.id),avatar:e.jsx(W,{children:s.name[0]}),label:s.name,sx:{fontWeight:400,fontSize:18,cursor:"pointer"}})})]}):e.jsx(o,{children:"Assignee: unspecified"})})},re=U(()=>{const{projectId:s,taskId:n}=S(),t=h.getById(n);if(!t||!s)return e.jsx(o,{children:"Error"});const l=j.getManyById(t.team);return e.jsxs(m,{spacing:2,children:[e.jsxs(R,{title:t.name,children:[e.jsx(N,{id:t.id,name:t.name}),e.jsx(O,{id:t.id,name:t.name,redirectOnDelete:v("",y.Projects,s)})]}),e.jsx(o,{children:t.description||"No description provided"}),e.jsx(Q,{assignee:t.assignee}),e.jsx(K,{taskId:t.id,team:l})]})});export{re as default};
