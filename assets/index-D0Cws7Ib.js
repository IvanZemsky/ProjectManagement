import{r as h,e as j,j as e,T as o,S as m,f as y,n as B,l as w,q as C,L as M,s as z,R as A,u as D,i as F}from"./index-CALslcgW.js";import{t as f}from"./store-Dl7FaPhY.js";import{C as E}from"./TaskColumn-BEvx6-Lq.js";import{T as S,E as L,A as P,o as R,a as W,D as N}from"./DeleteTaskBtn-eR6RybsC.js";import{F as O}from"./index.esm-D8IyPk3G.js";import{I as q}from"./TextField-1CeUxQMA.js";import{S as H}from"./Select-DlWwfj1p.js";import{M as U}from"./MenuItem-MNCwVu8Y.js";import"./constants-CaX98ONQ.js";import"./utils-Bt3GB74b.js";const V=({taskId:s,setEditedTask:a})=>{const[t,l]=h.useState(!1),d=f.getById(s),x=j.get();if(!d||!x)return e.jsx(o,{children:"Error"});const g=j.getManyById(d.team),[i,p]=h.useState(g),u=n=>{const r=n.target.value,c=j.getById(r);c&&p(b=>[...b,c])},I=n=>{p(i.filter(r=>r.id!==n))},k=x.data.filter(n=>{var r;return!i.some(c=>c.id===n.id)&&n.id!==((r=d.assignee)==null?void 0:r.id)});h.useEffect(()=>{l(!1)},[i]);const v=n=>{n.preventDefault();const r=i.map(c=>c.id);a({...d,team:r}),l(!0)};return e.jsx("form",{noValidate:!0,onSubmit:v,children:e.jsxs(m,{spacing:2,sx:{alignItems:"flex-start"},children:[e.jsxs(O,{fullWidth:!0,children:[e.jsx(q,{id:"task-executor-label",size:"small",children:"Executor"}),e.jsx(H,{id:"task-executor",labelId:"task-executor-label",label:"Executor",size:"small",value:"",onChange:u,disabled:!k.length,sx:{alignSelf:"flex-start",width:"100%"},children:k.map(n=>e.jsx(U,{value:n.id,children:n.name},n.id))})]}),i.length?e.jsx(S,{team:i,onDelete:I,links:!1}):e.jsx(o,{children:"Task team is empty now"}),e.jsxs(m,{direction:"row",spacing:2,sx:{alignItems:"center"},children:[e.jsx(y,{variant:"contained",type:"submit",children:"Save"}),t&&e.jsx(o,{color:"success",children:"Changes saved."})]})]})})},T=({taskId:s,onEditorClose:a})=>{var u;const t=(u=f.getById(s))==null?void 0:u.name,[l,d]=h.useState(null),x=()=>{l&&f.update(l),a&&a()},{openModal:g,handleModalOpen:i,handleModalClose:p}=B(!1,x);return e.jsxs(e.Fragment,{children:[e.jsx(E,{sx:{fontSize:16},label:"Edit team",variant:"outlined",color:"primary",icon:e.jsx(L,{fontSize:"small"}),onClick:i,clickable:!0}),e.jsx(w,{title:`Edit team of task '${t}'`,open:g,onClose:p,children:e.jsx(V,{taskId:s,setEditedTask:d})})]})},$=({taskId:s,team:a})=>a.length?e.jsx(S,{team:a,editBtn:e.jsx(T,{taskId:s})}):e.jsxs(m,{spacing:2,direction:"row",sx:{flexWrap:"wrap",alignItems:"center"},children:[e.jsx(o,{children:"Task team is empty now."}),e.jsx(T,{taskId:s})]}),G=({assignee:s})=>{var a;return e.jsx(m,{spacing:2,direction:"row",sx:{flexWrap:"wrap",alignItems:"center"},children:s?e.jsxs(e.Fragment,{children:[e.jsx(o,{children:"Assignee: "}),e.jsx(C,{title:((a=s.position)==null?void 0:a.name)||"Unspecified position",arrow:!0,children:e.jsx(E,{component:M,to:z("",A.Executors,s.id),avatar:e.jsx(P,{children:s.name[0]}),label:s.name,sx:{fontWeight:400,fontSize:18,cursor:"pointer"}})})]}):e.jsx(o,{children:"Assignee: unspecified"})})},ae=R(()=>{const{projectId:s,taskId:a}=D(),t=f.getById(a);if(!t||!s)return e.jsx(o,{children:"Error"});const l=j.getManyById(t.team);return e.jsxs(m,{spacing:2,children:[e.jsxs(F,{title:t.name,children:[e.jsx(W,{id:t.id,name:t.name}),e.jsx(N,{id:t.id,name:t.name,projectId:s,redirectOnDelete:!0})]}),e.jsx(o,{children:t.description||"No description provided"}),e.jsx(G,{assignee:t.assignee}),e.jsx($,{taskId:t.id,team:l})]})});export{ae as default};
