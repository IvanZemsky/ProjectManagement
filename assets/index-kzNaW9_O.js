import{r as h,e as j,j as e,T as o,S as m,f as y,n as B,l as w,p as C,L as M,s as z,R as A,u as D,i as F}from"./index-C-jB6FNB.js";import{t as f}from"./store-D9YZTOGP.js";import{C as E}from"./TaskColumn-Dh9yuy7A.js";import{T as S,E as L,A as P,o as R,a as W,D as N}from"./DeleteTaskBtn-BZkZVHWs.js";import{F as O}from"./index.esm-hwsnyq1X.js";import{I as H}from"./TextField-DlPsTCXm.js";import{S as U}from"./Select-B_KLR2p3.js";import{M as V}from"./MenuItem-BmaKOZhk.js";import"./constants-CaX98ONQ.js";import"./utils-DTIyCc5Y.js";const $=({taskId:s,setEditedTask:n})=>{const[t,l]=h.useState(!1),d=f.getById(s),x=j.get();if(!d||!x)return e.jsx(o,{children:"Error"});const g=j.getManyById(d.team),[i,p]=h.useState(g),u=a=>{const r=a.target.value,c=j.getById(r);c&&p(b=>[...b,c])},I=a=>{p(i.filter(r=>r.id!==a))},k=x.data.filter(a=>{var r;return!i.some(c=>c.id===a.id)&&a.id!==((r=d.assignee)==null?void 0:r.id)});h.useEffect(()=>{l(!1)},[i]);const v=a=>{a.preventDefault();const r=i.map(c=>c.id);n({...d,team:r}),l(!0)};return e.jsx("form",{noValidate:!0,onSubmit:v,children:e.jsxs(m,{spacing:2,sx:{alignItems:"flex-start"},children:[e.jsxs(O,{fullWidth:!0,children:[e.jsx(H,{id:"task-executor-label",size:"small",children:"Executor"}),e.jsx(U,{id:"task-executor",labelId:"task-executor-label",label:"Executor",size:"small",value:"",onChange:u,disabled:!k.length,sx:{alignSelf:"flex-start",width:"100%"},children:k.map(a=>e.jsx(V,{value:a.id,children:a.name},a.id))})]}),i.length?e.jsx(S,{team:i,onDelete:I,link:!1}):e.jsx(o,{children:"Task team is empty now"}),e.jsxs(m,{direction:"row",spacing:2,sx:{alignItems:"center"},children:[e.jsx(y,{variant:"contained",type:"submit",children:"Save"}),t&&e.jsx(o,{color:"success",children:"Changes saved."})]})]})})},T=({taskId:s,onEditorClose:n})=>{var u;const t=(u=f.getById(s))==null?void 0:u.name,[l,d]=h.useState(null),x=()=>{l&&f.update(l),n&&n()},{openModal:g,handleModalOpen:i,handleModalClose:p}=B(!1,x);return e.jsxs(e.Fragment,{children:[e.jsx(E,{sx:{fontSize:16},label:"Edit team",variant:"outlined",color:"primary",icon:e.jsx(L,{fontSize:"small"}),onClick:i,clickable:!0}),e.jsx(w,{title:`Edit team of task '${t}'`,open:g,onClose:p,children:e.jsx($,{taskId:s,setEditedTask:d})})]})},q=({taskId:s,team:n})=>n.length?e.jsx(S,{team:n,editBtn:e.jsx(T,{taskId:s})}):e.jsxs(m,{spacing:2,direction:"row",sx:{flexWrap:"wrap",alignItems:"center"},children:[e.jsx(o,{children:"Task team is empty now."}),e.jsx(T,{taskId:s})]}),G=({assignee:s})=>e.jsx(m,{spacing:2,direction:"row",sx:{flexWrap:"wrap",alignItems:"center"},children:s?e.jsxs(e.Fragment,{children:[e.jsx(o,{children:"Assignee: "}),e.jsx(C,{title:s.position||"Unspecified position",arrow:!0,children:e.jsx(E,{component:M,to:z("",A.Executors,s.id),avatar:e.jsx(P,{children:s.name[0]}),label:s.name,sx:{fontWeight:400,fontSize:18,cursor:"pointer"}})})]}):e.jsx(o,{children:"Assignee: unspecified"})}),ae=R(()=>{const{projectId:s,taskId:n}=D(),t=f.getById(n);if(!t||!s)return e.jsx(o,{children:"Error"});const l=j.getManyById(t.team);return e.jsxs(m,{spacing:2,children:[e.jsxs(F,{title:t.name,children:[e.jsx(W,{id:t.id,name:t.name}),e.jsx(N,{id:t.id,name:t.name,projectId:s,redirectOnDelete:!0})]}),e.jsx(o,{children:t.description||"No description provided"}),e.jsx(G,{assignee:t.assignee}),e.jsx(q,{taskId:t.id,team:l})]})});export{ae as default};
