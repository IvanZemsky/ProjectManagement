import{e as d,b as u,v as m,c as f,m as j,A as p}from"./index-CALslcgW.js";import{t as g}from"./store-Dl7FaPhY.js";const h=l=>{const t=new Date(l),a=t.getFullYear(),e=t.getMonth()+1,s=t.getDate(),r=s<10?`0${s}`:s,n=e<10?`0${e}`:e;return`${r}.${n}.${a}`};class I{constructor(){this.projects=[],this.isInitialized=!1,this.get=(t,a)=>{const e=this.projects.length,s=this.projects.map(c=>this.mapToProject(c));if(t===void 0||a===void 0)return{data:s,totalCount:e};const r=(a-1)*t;return{data:s.slice(r,r+t),totalCount:e}},this.getById=t=>{const a=this.projects.find(e=>e.id===t);return a?this.mapToProject(a):null},this.getTeam=t=>{const a=g.getByProjectId(t),e=d.get();if(!e)return null;const s=a.flatMap(o=>o.team),r=a.map(o=>{var i;return(i=o.assignee)==null?void 0:i.id}).filter(o=>o!==void 0),n=[...s,...r];return e.data.filter(o=>n.some(i=>o.id===i))},this.getAllWithLead=(t,a,e)=>{const s=this.projects.filter(o=>o.leadId===t).map(o=>this.mapToProject(o)),r=s.length;if(e===void 0||a===void 0)return{data:s,totalCount:r};const n=(a-1)*e;return{data:s.slice(n,n+e),totalCount:r}},this.create=t=>{const e=t.leadId===u.Unspecified?null:d.getById(t.leadId),s={id:m(),name:t.name,description:t.description,leadId:(e==null?void 0:e.id)||null,startDate:h(t.startDate),endDate:h(t.endDate)};return this.projects.push(s),this.mapToProject(s)},this.autosaveState=()=>{f(()=>{this.isInitialized&&p.set("projects",this.projects)})},j(this),this.loadProjects(),this.autosaveState()}loadProjects(){this.projects=p.get("projects")||[],this.isInitialized=!0}mapToProject(t){const a=t.leadId?d.getById(t.leadId):null,{leadId:e,...s}=t;return{...s,lead:a}}}const S=new I;export{S as p};
