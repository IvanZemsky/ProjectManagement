import{r as p,K as S,j as e,T as c,S as j,H as M,o as C,n as w,M as P,R as D}from"./index-DW7niEK_.js";import{T as y,E as z,D as F,A as R}from"./DeleteTaskBtn-DyCf6E-3.js";import{t as h,e as u,p as L}from"./store-DDDbk47J.js";import{C as A}from"./TaskColumn-Cf5tcA9W.js";import{P as H}from"./PageHeader-BcXiUKO0.js";import{E as N,o as O}from"./Delete-CcYEeSlv.js";import{F as W}from"./index.esm-BZsw8hz4.js";import{I as K}from"./TextField-D9CnMREb.js";import{S as V}from"./Select-DnoR1PEi.js";import{M as $}from"./MenuItem-3KFYzs4i.js";import"./constants-DWoOd6FE.js";import"./CardContent-DhbWX8Eh.js";import"./utils-C_uqNxTM.js";const q=({taskId:a,setEditedTask:n})=>{const[t,o]=p.useState(!1),{projectId:f}=S(),d=h.getById(a),m=u.get(),x=L.getById(f);if(!d||!m||!x)return e.jsx(c,{children:"Error"});const g=u.getManyById(d.team),[r,T]=p.useState(g),v=s=>{const i=s.target.value,l=u.getById(i);l&&T(k=>[...k,l])},b=s=>{T(r.filter(i=>i.id!==s))},E=m.data.filter(s=>{var i,l;return!r.some(k=>k.id===s.id)&&s.id!==((i=d.assignee)==null?void 0:i.id)&&s.id!==((l=x.lead)==null?void 0:l.id)});p.useEffect(()=>{o(!1)},[r]);const B=s=>{s.preventDefault();const i=r.map(l=>l.id);n({...d,team:i}),o(!0)};return e.jsx("form",{noValidate:!0,onSubmit:B,children:e.jsxs(j,{spacing:2,sx:{alignItems:"flex-start"},children:[e.jsxs(W,{fullWidth:!0,children:[e.jsx(K,{id:"task-executor-label",size:"small",children:"Executor"}),e.jsx(V,{id:"task-executor",labelId:"task-executor-label",label:"Executor",size:"small",value:"",onChange:v,disabled:!E.length,sx:{alignSelf:"flex-start",width:"100%"},children:E.map(s=>e.jsx($,{value:s.id,children:s.name},s.id))})]}),r.length?e.jsx(y,{team:r,onDelete:b,links:!1}):e.jsx(c,{children:"Task team is empty now"}),e.jsxs(j,{direction:"row",spacing:2,sx:{alignItems:"center"},children:[e.jsx(M,{variant:"contained",type:"submit",children:"Save"}),t&&e.jsx(c,{color:"success",children:"Changes saved."})]})]})})},I=({taskId:a,onEditorClose:n})=>{var r;const t=(r=h.getById(a))==null?void 0:r.name,[o,f]=p.useState(null),d=()=>{o&&h.update(o),n&&n()},{openModal:m,handleModalOpen:x,handleModalClose:g}=C(!1,d);return e.jsxs(e.Fragment,{children:[e.jsx(A,{sx:{fontSize:16},label:"Edit team",variant:"outlined",color:"primary",icon:e.jsx(N,{fontSize:"small"}),onClick:x,clickable:!0}),e.jsx(w,{title:`Edit team of task '${t}'`,open:m,onClose:g,children:e.jsx(q,{taskId:a,setEditedTask:f})})]})},G=({taskId:a,team:n})=>n.length?e.jsx(y,{team:n,editBtn:e.jsx(I,{taskId:a})}):e.jsxs(j,{spacing:2,direction:"row",sx:{flexWrap:"wrap",alignItems:"center"},children:[e.jsx(c,{children:"Task team is empty now."}),e.jsx(I,{taskId:a})]}),ie=O(()=>{const{projectId:a,taskId:n}=S(),t=h.getById(n);if(!t||!a)return e.jsx(c,{children:"Error"});const o=u.getManyById(t.team);return e.jsxs(j,{spacing:2,children:[e.jsxs(H,{title:t.name,children:[e.jsx(z,{id:t.id,name:t.name}),e.jsx(F,{id:t.id,name:t.name,redirectOnDelete:P("",D.Projects,a)})]}),e.jsx(c,{children:t.description||"No description provided"}),e.jsx(R,{assignee:t.assignee}),e.jsx(G,{taskId:t.id,team:o})]})});export{ie as default};
